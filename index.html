<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>Not My Cows</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta property="og:title" content="Not My Cows">
    <meta name="og:description" content="Outer space has unleashed its fury! Protect your live stock, your livelihood, your home. It's all you've got left...">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <style>
      @font-face {
        font-family: 'Broken Console';
        src: url('/fonts/broken-console/BrokenConsole-Regular.woff2') format('woff2'), url('/fonts/broken-console/BrokenConsole-Regular.woff') format('woff');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: 'Broken Console';
        src: url('/fonts/broken-console/BrokenConsole-Bold.woff2') format('woff2'), url('/fonts/broken-console/BrokenConsole-Bold.woff') format('woff');
        font-weight: bold;
        font-style: normal;
        font-display: swap;
      }
      @font-face {
        font-family: 'Broken Console Shadow';
        src: url('/fonts/broken-console/BrokenConsole-BoldShadow.woff2') format('woff2'), url('/fonts/broken-console/BrokenConsole-BoldShadow.woff') format('woff');
        font-weight: bold;
        font-style: normal;
        font-display: swap;
      }
    	* {
        padding: 0;
        margin: 0;
        font-family: Helvetica Neue;
      }
      canvas {
        display: block;
        margin: 0 auto;
        border-radius: 10px;
        border: 2px solid white;
      }
      body {
        background: #34495e;
        color: white;
      }
      h1 {
        color: white;
        padding: 0px 0px;
        font-family: 'Broken Console';
        text-shadow: 4px 3px white;
      }
      h6, h3, h4, p, a, b, button {
        color: #2c3e50;
        padding: 10px 0px;
        font-family: 'Menlo';
      }
      

    </style>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-07BC377BXY"></script>
    <script>
      if (window.origin.includes('notmycows.com') || window.origin.includes('jonfranco224.github.io')) {
        console.log('GTM Loaded')
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-07BC377BXY');
      }
    </script>
</head>
<body>
<nav style="display: flex; align-items: center; gap: 20px; max-width: 720px; margin: 0 auto;">
  <div style="display: flex; justify-content: center; align-items: center; gap: 10px;">
    <img src="favicon.png" alt="cow" style="max-width: 30px;">
    <p style="color: white; font-size: 18px;">Not My Cows</p>
  </div>
  <div style="flex: 1; display: flex; justify-content: center;">
    <button id="mute-button" style="padding: 10px 15px; border-radius: 8px; background: white; border: 0; font-size: 16px; cursor: pointer;">Mute Music</button>
  </div>
  <a href="https://twitter.com/notmycowsgame" style="color: white; padding: 25px 0px; font-size: 18px; display: flex; justify-content: center; align-items: center; gap: 10px;" target="_blank">
    Follow
    <svg style="width: 100%; max-width: 24px; fill: white;" viewBox="0 0 24 24" aria-hidden="true"><g><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path></g></svg>
  </a>
  <a href="https://github.com/jonfranco224/not-my-cows/blob/master/index.html" style="display: flex; justify-content: center; align-items: center; color: white; fill: white; gap: 10px; font-size: 18px;" target="_blank">
    Code 
    <svg style="max-width: 24px;" height="24" aria-hidden="true" viewBox="0 0 16 16" version="1.1" width="24" data-view-component="true" class="octicon octicon-mark-github v-align-middle">
      <path d="M8 0c4.42 0 8 3.58 8 8a8.013 8.013 0 0 1-5.45 7.59c-.4.08-.55-.17-.55-.38 0-.27.01-1.13.01-2.2 0-.75-.25-1.23-.54-1.48 1.78-.2 3.65-.88 3.65-3.95 0-.88-.31-1.59-.82-2.15.08-.2.36-1.02-.08-2.12 0 0-.67-.22-2.2.82-.64-.18-1.32-.27-2-.27-.68 0-1.36.09-2 .27-1.53-1.03-2.2-.82-2.2-.82-.44 1.1-.16 1.92-.08 2.12-.51.56-.82 1.28-.82 2.15 0 3.06 1.86 3.75 3.64 3.95-.23.2-.44.55-.51 1.07-.46.21-1.61.55-2.33-.66-.15-.24-.6-.83-1.23-.82-.67.01-.27.38.01.53.34.19.73.9.82 1.13.16.45.68 1.31 2.69.94 0 .67.01 1.3.01 1.49 0 .21-.15.45-.55.38A7.995 7.995 0 0 1 0 8c0-4.42 3.58-8 8-8Z"></path>
    </svg>
  </a>
</nav>
<div style="position: relative; width: 720px; height: 550px; margin: 0 auto;">
  <div id='splash-screen' style="position: absolute; width: 100%; margin-top: 70px; z-index: 2; top: 0; left: 0; display: flex; flex-direction: column; justify-content: center; align-items: center;">
    <h1 style="font-size: 55px; color: #34495e;">Not My Cows!</h1>
    <p style="width: 600px; text-align: center; font-size: 16px;">Outer space has unleashed its fury! Protect your live stock, your livelihood, your home. It's all you've got left...</p>
    <div style="width: 400px; padding: 15px 0px;">
      <p style="padding: 5px 0px; text-align: center;">• <b>Move</b> with <b>A</b> and <b>D</b> • </p>
      <p style="padding: 5px 0px; text-align: center;">• <b>Aim</b> with <b>Right &rarr;</b> and <b>Left &larr;</b> • </p>
      <p style="padding: 5px 0px; text-align: center;">• <b>Shoot</b> with <b>Up &uarr;</b> or <b>Spacebar</b> • </p>
    </div>
    <h3 style="padding: 5px 0px; display: block; font-size: 16px;">-- Press Enter To Begin --</h3>
  </div>
  <canvas style="position: absolute; z-index: 1; background: center / cover no-repeat url('/assets/img/farm-bg.png'); image-rendering: pixelated;" id="myCanvas" width="720" height="550" />
</div>

<!-- <img id="farm-bg" style="display: none;" src="" /> -->
<img id="cow" style="display: none;" src="assets/img/cow.png" />
<img id="farm" style="display: none;" src="assets/img/farm.png" />
<img id="farmer" style="display: none;" src="assets/img/farmer.png" />
<img id="turretlayer" style="display: none;" src="assets/img/turretlayer-v2.png" />
<img id="lasershot" style="display: none;" src="assets/img/lasershot.png" />
<img id="meteor" style="display: none;" src="assets/img/meteor.png" />
<img id="fragment" style="display: none;" src="assets/img/fragment.png" />
<img id="explosion" style="display: none;" src="assets/img/explosion.png" />

<script>
const debugImage = true
const debugRect = false
const canvas = document.getElementById('myCanvas')
const ctx = canvas.getContext('2d')

const farmBG = document.querySelector('#farm-bg')
const cow = document.querySelector('#cow')
const farmerSprite = document.querySelector('#farmer')
const lasershot = document.querySelector('#lasershot')
const meteor = document.querySelector('#meteor')
const fragment = document.querySelector('#fragment')
const explosion = document.querySelector('#explosion')

let soundsLoaded = false
let deploy
let gun_sfx
let yeehaw_sfx
let bluegrass_sfx
let explosion_sfx
let moo_sfx

const muteButton = document.querySelector('#mute-button')
muteButton.addEventListener('click', () => {
  if (bluegrass_sfx.volume === 0) {
    bluegrass_sfx.volume = .5
  } else {
    bluegrass_sfx.volume = 0
  }
})
let rightAimPressed = 0
let leftAimPressed = 0
let rightPressed = 0
let leftPressed = 0
let upPressed = 0
let enterPressed = 0

document.addEventListener('keydown', keyDownHandler, false)
document.addEventListener('keyup', keyUpHandler, false)

function keyDownHandler (e) {
  if (e.code === 'ArrowRight') rightAimPressed = 1
  if (e.code === 'ArrowLeft') leftAimPressed = 1
  if (e.code === 'ArrowUp' || e.code === 'Space') upPressed = 1
  if (e.code === 'KeyD') rightPressed = 1
  if (e.code === 'KeyA') leftPressed = 1
  if (e.code === 'Enter') enterPressed = 1
}

function keyUpHandler (e) {
  if (e.code === 'ArrowRight') rightAimPressed = 0
  if (e.code === 'ArrowLeft') leftAimPressed = 0
  if (e.code === 'ArrowUp' || e.code === 'Space') upPressed = 0
  if (e.code === 'KeyD') rightPressed = 0
  if (e.code === 'KeyA') leftPressed = 0
  if (e.code === 'Enter') enterPressed = 0
}

function getRandomInt (min, max) {
  min = Math.ceil(min)
  max = Math.floor(max)
  return Math.floor(Math.random() * (max - min)) + min //The maximum is exclusive and the minimum is inclusive
}

// --UI -- //

const drawText = (ctx, options) => {
  const { text, x, y, fontSize, horizontalPadding, verticalPadding, hAlignment, vAlignment } = options;

  ctx.font = `${fontSize}px Broken Console`;

  // Calculate text dimensions
  const textMetrics = ctx.measureText(text);
  const buttonWidth = textMetrics.width + 2 * horizontalPadding;
  const buttonHeight = textMetrics.actualBoundingBoxAscent + textMetrics.actualBoundingBoxDescent + 2 * verticalPadding;

  // Adjust x based on hAlignment or specific value
  let adjustedX;
  if (typeof x !== 'undefined') {
    adjustedX = x;
  } else {
    if (hAlignment === 'center') {
      adjustedX = (ctx.canvas.width - buttonWidth) / 2;
    } else if (hAlignment === 'right') {
      adjustedX = ctx.canvas.width - buttonWidth;
    } else { // Default to 'left'
      adjustedX = 0;
    }
  }

  // Adjust y based on vAlignment or specific value
  let adjustedY;
  if (typeof y !== 'undefined') {
    adjustedY = y;
  } else {
    if (vAlignment === 'middle') {
      adjustedY = (ctx.canvas.height - buttonHeight) / 2;
    } else if (vAlignment === 'bottom') {
      adjustedY = ctx.canvas.height - buttonHeight;
    } else { // Default to 'top'
      adjustedY = 0;
    }
  }

  // Draw button background
  ctx.fillStyle = 'transparent';
  ctx.fillRect(adjustedX, adjustedY, buttonWidth, buttonHeight);

  // Set up stroke properties
  ctx.strokeStyle = 'black'; // set the stroke color
  ctx.lineWidth = 0;         // set the stroke width

  // Draw text
  ctx.fillStyle = 'white';
  ctx.fillText(
    text,
    adjustedX + horizontalPadding,
    adjustedY + verticalPadding + textMetrics.actualBoundingBoxAscent
  );

  // Stroke the text
  // ctx.strokeText(
  //     text,
  //     adjustedX + horizontalPadding,
  //     adjustedY + verticalPadding + textMetrics.actualBoundingBoxAscent
  // );

  // Check if hAlignment is used and update startButton's x if it is
  if (typeof x === 'undefined' && hAlignment) {
    options.x = adjustedX; // Update the x value in startButton
  }

  // Check if vAlignment is used and update startButton's y if it is
  if (typeof y === 'undefined' && vAlignment) {
      options.y = adjustedY; // Update the y value in startButton
  }

  // Update width and height always
  options.width = buttonWidth;
  options.height = buttonHeight;

  // Return button dimensions for click detection
  return {
    x: adjustedX,
    y: adjustedY,
    width: buttonWidth,
    height: buttonHeight
  };
}

// ----- Game ------ // 

const GAME_WIDTH = canvas.width
const GAME_HEIGHT = canvas.height

const textures = [
  '#000000',
  '#8e44ad',
  '#e67e22',
  '#f1c40f', // yellow
  '#7f8c8d' // dark gray
]

const COWS_MAX = 5
const METEORS_MAX = 50
const PARTICLES_MAX = 100
const BULLETS_MAX = 100

let farmer
let house
let crop
let gun
let cowsLeft = []
let bullets = []
let meteors = []
let particles = []
let score = 0

function collision (a, b) {
  const xcollide = (a.x + a.w) >= b.x && a.x < (b.x + b.w)
  const ycollide = (a.y + a.h) >= b.y && a.y < (b.y + b.h)
  return xcollide && ycollide
}

function degreesToRadians(degrees) {
  return degrees * (Math.PI / 180)
}

function endpoint(cx, cy, r, theta) {
  let x = cx + r * Math.cos(theta)
  let y = cy + r * Math.sin(theta)
  return {x, y}
}


function drawRect (x, y, w, h, t, deg, img) {
  if (t) ctx.fillStyle = textures[t]
  if (deg) {
    ctx.save()
    ctx.translate((x + (w / 2)), y + h)
    ctx.rotate(deg * Math.PI / 180)
    ctx.translate(-(x + (w / 2)), -(y + h))
  }

  if (img) {
    ctx.drawImage(img, x, y, w, h)
  } else {
    ctx.fillRect(x, y, w, h)
  }

  ctx.restore()
}

function updateFarmer () {
  farmer.speed_x = (leftPressed || rightPressed) ? (leftPressed ? -5 : 5) : 0
  farmer.x += farmer.speed_x
}

function updateGun () {
  if (gun.can_fire > 0) gun.can_fire--

  if (rightAimPressed) gun.deg += gun.deg < 90 ? 3 : 0
  if (leftAimPressed) gun.deg -= gun.deg > -90 ? 3 : 0

  gun.x = farmer.x + (farmer.w / 2) - (gun.w / 2)
  gun.y = farmer.y - farmer.h - 70
}

function fireBullet () {
  if (gun.can_fire > 0) return

  const bulletWidth = 10
  const bulletHeight = 10

  gun.can_fire = 5
  let x_ratio = Math.sin(gun.deg * (Math.PI / 180))
  let y_ratio = -Math.cos(gun.deg * (Math.PI / 180))
  
  // Target the x,y that is the distance of the gun away from the center firing point
  const offsetIntoMuzzle = 20
  const centerX = gun.x + (gun.w / 2) - (bulletWidth / 2)
  const centerY = gun.y + gun.h - (bulletHeight / 2)
  const rad = degreesToRadians(gun.deg - 90)
  const target = endpoint(centerX, centerY, gun.h - offsetIntoMuzzle, rad)
  let x = target.x
  let y = target.y

  if (farmer.speed_x * x_ratio < 0) farmer.speed_x = 0 // correct for away farmer movement's affect on bullet trajectory

  for (let i = 0; i < BULLETS_MAX; i++) {
    if (bullets[i].dur === 0) {
      bullets[i].w = bulletWidth
      bullets[i].h = bulletHeight
      bullets[i].x = x
      bullets[i].y = y
      bullets[i].t = 1
      bullets[i].x_ratio = x_ratio
      bullets[i].y_ratio = y_ratio
      bullets[i].speed_x = farmer.speed_x
      bullets[i].dur = 70
      break
    }
  }
}

function spawnExplosion (x_origin, y_origin, x_speed, y_speed, num_of_particles) {
  for (let i = 0; i < num_of_particles; i++) {
    for (let i = 0; i < PARTICLES_MAX; i++) {
      if (particles[i] && particles[i].dur === 0) {
        particles[i].x = x_origin
        particles[i].y = y_origin
        particles[i].x_speed = x_speed + getRandomInt(-3, 3)
        particles[i].y_speed = y_speed + getRandomInt(-3, 3)
        particles[i].dur = 200
        break
      }
    }
  }
}

function spawnMeteors (num_of) {
  for (let i = 0; i < num_of; i++) {
    if (meteors[i] === undefined) continue
    
    const meteor_max_height = 40

    // to make harder, incrememnt values of size, speed, and fall angle
    const meteor_speed = 1
    const meteor_scale = getRandomInt(25, meteor_max_height)
    const meteor_fall_angle = getRandomInt(meteor_speed, 5)

    const originX = getRandomInt(0, GAME_WIDTH)
    const originY = getRandomInt((GAME_HEIGHT * -0.2), -meteor_max_height)
    const dir = originX > (GAME_WIDTH / 2) ? -1 : 1

    meteors[i].x = originX
    meteors[i].y = originY
    meteors[i].w = meteor_scale
    meteors[i].h = meteor_scale
    meteors[i].x_dir = meteor_speed * dir
    meteors[i].y_dir = meteor_speed * meteor_fall_angle
    meteors[i].t = 0
    meteors[i].blown_up = 0
  }
}

function initMeteors () {
  for (let i = 0; i < METEORS_MAX; i++) meteors[i] = {}
}

function initBullets () {
  for (let i = 0; i < BULLETS_MAX; i++) {
    bullets[i] = {
      x: 0, y: 0, w: 0, h: 0, t: 0, x_ratio: 0, y_ratio: 0, speed_x: 0, dur: 0
    }
  }
}

function initParticles () {
  for (let i = 0; i < PARTICLES_MAX; i++) {
    particles[i] = { x: 0, y: 0, w: 10, h: 10, x_speed: 0, y_speed: 0, dur: 0, t: 0 }
  }
}

function updateBullets () {
  for (let i = 0; i < bullets.length; i++) {
    bullets[i].x_ratio *= 0.99
    bullets[i].y_ratio *= 0.99
    bullets[i].x += (bullets[i].x_ratio * 8.5) + bullets[i].speed_x
    bullets[i].y += (bullets[i].y_ratio * 8.5)
  }
}

function updateMeteors () {
  for (let i = 0; i < meteors.length; i++) {
    meteors[i].x_dir *= 1.003
    meteors[i].y_dir *= 1.003
    meteors[i].x += meteors[i].x_dir
    meteors[i].y += meteors[i].y_dir
  }
}

function drawEnemies () {
  for (let i = 0; i < meteors.length; i++) {
    if (meteors[i].blown_up === 0) {
      if (debugRect) drawRect(meteors[i].x, meteors[i].y, meteors[i].w, meteors[i].h, meteors[i].t) 
      if (debugImage) ctx.drawImage(meteor, meteors[i].x - 5, meteors[i].y - 5, meteors[i].w + 10, meteors[i].h + 10)
    }
  }
}

function drawBullets () {
  for (let i = 0; i < bullets.length; i++) {
    if (bullets[i].dur > 0) {
      if (debugImage) ctx.drawImage(lasershot, bullets[i].x - 4, bullets[i].y - bullets[i].h + 6, 18, 18)
      if (debugRect) drawRect(bullets[i].x, bullets[i].y, bullets[i].w, bullets[i].h, bullets[i].t)
      bullets[i].dur--
    }
  }
}

function drawParticles () {
  for (let i = 0; i < particles.length; i++) {
    if (particles[i].dur > 0) {
      particles[i].x += particles[i].x_speed
      particles[i].y += particles[i].y_speed

      if (debugImage) ctx.drawImage(fragment, particles[i].x, particles[i].y, particles[i].w, particles[i].h)
      if (debugRect) drawRect(particles[i].x, particles[i].y, particles[i].w, particles[i].h, particles[i].t)
      particles[i].dur--
    }
  }
}

function initCows () {
  for (let i = 0; i < cowsLeft.length; i++) {
    cowsLeft[i].x = getRandomInt(50, GAME_WIDTH)
    cowsLeft[i].x_speed = getRandomInt(0, 2) === 0 ? 1 : -1
    cowsLeft[i].switch_dur = getRandomInt(50, 300)
  }
}

function updateCows () {
  for (let i = 0; i < cowsLeft.length; i++) {
    cowsLeft[i].x += cowsLeft[i].x_speed * 0.3
    if (cowsLeft[i].switch_dur > 0) {
      cowsLeft[i].switch_dur--
    } else {
      cowsLeft[i].x_speed *= -1
      cowsLeft[i].switch_dur = getRandomInt(50, 300)
      cowsLeft[i].dir = cowsLeft[i].x_speed > 0 ?  1 : 0
    }
  }
}

function drawCows () {
  for (let i = 0; i < cowsLeft.length; i++) {
    //if (debugImage) ctx.drawImage(image, sx, sy, sWidth, sHeight, dx, dy, dWidth, dHeight);
    const spritesheet_offset = cowsLeft[i].x_speed > 0 ? 64 : 0
    if (cowsLeft[i].dead === 0) ctx.drawImage(cow, spritesheet_offset, 0, 64, 64, cowsLeft[i].x - 25, cowsLeft[i].y - 45, 64, 64)
    //if (debugRect) drawRect(cowsLeft[i].x, cowsLeft[i].y, cowsLeft[i].w, cowsLeft[i].h, cowsLeft[i].t)
  }
}

function checkCollisions () {
  for (let a = 0; a < bullets.length; a++) {
    for (let b = 0; b < meteors.length; b++) {
      if (meteors[b].blown_up === 1) continue
      if (collision(bullets[a], meteors[b])) {
        explosion_sfx.pause()
        explosion_sfx.currentTime = 0
        explosion_sfx.play()
        spawnExplosion(
          meteors[b].x + (meteors[b].w / 2),
          meteors[b].y + (meteors[b].h / 2),
          bullets[a].x_ratio * 4,
          bullets[a].y_ratio * 4,
          10)
        meteors[b].blown_up = 1
        score += 10
      }
    }
  }

  for (let c = 0; c < meteors.length; c++) {
    //if (collision(house, meteors[c])) console.log('game over')
    if (meteors[c].blown_up === 1) continue
    for (let d = 0; d < cowsLeft.length; d++) {
      if (collision(meteors[c], cowsLeft[d])) {
        moo_sfx.pause()
        moo_sfx.currentTime = 150
        moo_sfx.play()

        cowsLeft[d].dead = 1
      }
    }
  }
}

function initGame () {
  score = 0

  farmer = {
    x: canvas.width / 2 - 10,
    y: canvas.height - 30,
    w: 20,
    h: 30,
    speed_x: 0,
    speed_y: 0,
    t: 0
  }

  gun = {
    x: canvas.width / 2 - 10,
    y: canvas.height - 30,
    w: 80,
    h: 80,
    t: 0,
    deg: 0,
    can_fire: 0
  }

  house = {
    x: canvas.width / 2 - 50,
    y: canvas.height - 50,
    w: 100,
    h: 50,
    t: 2
  }

  crop = {
    x: canvas.width / 2 - 75,
    y: canvas.height - 20,
    w: 150,
    h: 20,
    t: 3
  }

  for (let i = 0; i < COWS_MAX; i++) {
    cowsLeft[i] = {
      x: 0,
      y: canvas.height - 20,
      w: 30,
      h: 20,
      t: 4,
      x_speed: 0,
      y_speed: 0,
      switch_dur: 0,
      dead: 0
    }
  }

  initMeteors()
  initParticles()
  initBullets()
  initCows()
}

function runGame (tracker) {
  let numOf = 0
  if (tracker >= 0 && tracker < 500) {
    numOf = 10
  } else {
    numOf = 20
  }

  if (tracker % 400 === 0 || tracker === 5) spawnMeteors(numOf)

  updateFarmer()
  updateGun()
  updateBullets()
  updateMeteors()
  checkCollisions()
  updateCows()

  drawEnemies()
  drawParticles()
  
  // Farm/house
  if (debugImage) ctx.drawImage(farm, house.x, house.y - house.h + 10, 110, 90)
  if (debugRect) drawRect(house.x, house.y, house.w, house.h, house.t)

  drawCows()
  // if (debugImage) ctx.drawImage(farmer.x - farmer.w, gun.y - gun.h, 75, 75)
  
  drawBullets()
  
  // Gun
  if (debugRect) drawRect(gun.x, gun.y - gun.can_fire, gun.w, gun.h, gun.t, gun.deg)
  if (debugImage) drawRect(gun.x, gun.y - gun.can_fire, gun.w, gun.h, gun.t, gun.deg, turretlayer)

  drawStats()

  //Farmer
  if (debugImage) ctx.drawImage(farmerSprite, farmer.x - farmer.w - 20, farmer.y - farmer.h - 30, 105, 90)
  if (debugRect) drawRect(farmer.x, farmer.y, farmer.w, farmer.h, farmer.t)
}

let game_is_initialized = 0
let tracker = 0
let game_is_active = 0
const splash = document.querySelector('#splash-screen')

function resetGunSound() {
  gun_sfx.volume = .2;
  gun_sfx.pause();
  gun_sfx.currentTime = 0;
}

function displaySplash() {
  splash.style.display = 'flex';
  ctx.drawImage(cow, 0, 0, 64, 64, GAME_WIDTH / 4, GAME_HEIGHT - 64, 64, 64);
  ctx.drawImage(cow, 64, 0, 64, 64, GAME_WIDTH / 9, GAME_HEIGHT - 64, 64, 64);
  ctx.drawImage(cow, 64, 0, 64, 64, GAME_WIDTH - 132, GAME_HEIGHT - 64, 64, 64);
  ctx.drawImage(farm, house.x, house.y - house.h + 10, 110, 90);
  ctx.drawImage(farmerSprite, farmer.x - farmer.w - 20, farmer.y - farmer.h - 30, 105, 90);
}

function setGameState (tracker) {
  if (game_is_active && !game_is_initialized) {
    splash.style.display = 'none'
    initGame()
    yeehaw_sfx.play()
    // bluegrass_sfx.play()
    game_is_initialized = 1
    return
  }

  if (game_is_active && game_is_initialized) {
    if (upPressed) {
      gun_sfx.play()
      fireBullet()
    } else {
      resetGunSound()
    }

    runGame(tracker)
    return
  }

  // If enter is pressed and the game isn't initialized
  if (enterPressed && !game_is_initialized) {
    startGame()
    enterPressed = 0
    return
  }

  // Start Screen
  initGame()
  displaySplash()
  // updateCows()
  // drawCows()
}

function startGame () {
  if (!soundsLoaded) {
    deploy = new Audio('assets/sfx/deploy.mp3')
    gun_sfx = new Audio('assets/sfx/machine-gun.mp3')
    gun_sfx.volume = .5
    yeehaw_sfx = new Audio('assets/sfx/yeehaw.wav')
    yeehaw_sfx.volume = 0
    bluegrass_sfx = new Audio('assets/sfx/bluegrass.mp3')
    bluegrass_sfx.volume = .5
    explosion_sfx = new Audio('assets/sfx/explosion.mp3')
    moo_sfx = new Audio('assets/sfx/moo-2.wav')
    soundsLoaded = true
  }

  tracker = 0
  game_is_initialized = 0
  game_is_active = 1
}

function stopGame () {
  tracker = 0
  game_is_initialized = 0
  game_is_active = 0
}

function drawStats () {
  let numOf = 0
  for (let i = 0; i < cowsLeft.length; i++) {
    if (cowsLeft[i].dead === 0) numOf++
  }

  if (numOf === 0) stopGame()

  for (let i = 0; i < numOf; i++) {
    drawText(ctx, {
      visible: true,
      text: score,
      fontSize: 26,
      horizontalPadding: 20,
      verticalPadding: 20,
      hAlignment: 'right',
      vAlignment: 'top'
    })
    ctx.drawImage(cow, 0, 0, 64, 64, i + (i * 40) + 15, 0 + 10 , 32, 32)
  } 
}

let lastTimestamp = 0; // To track the timestamp of the last frame

function loop(timestamp) {
  const deltaTime = timestamp - lastTimestamp // Calculate time elapsed since the last frame
  lastTimestamp = timestamp
  
  if (deltaTime >= 16) {
    tracker++
    ctx.clearRect(0, 0, canvas.width, canvas.height)
    setGameState(tracker)
  }

  window.requestAnimationFrame(loop)
}
window.requestAnimationFrame(loop)
</script>
</body>
</html>